<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BERT CRM Showcase</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        margin: 0;
        padding: 0;
      }
      header {
        padding: 20px;
        background: linear-gradient(120deg, #1e293b, #0f172a);
      }
      header h1 {
        margin: 0;
        font-size: 20px;
      }
      header p {
        margin: 6px 0 0;
        color: #94a3b8;
        font-size: 13px;
      }
      .container {
        padding: 16px;
        display: grid;
        gap: 12px;
      }
      .card {
        background: #1e293b;
        border-radius: 12px;
        padding: 14px;
        box-shadow: 0 6px 16px rgba(15, 23, 42, 0.35);
      }
      .card h3 {
        margin: 0 0 8px;
        font-size: 16px;
      }
      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .kpi {
        background: #0f172a;
        border-radius: 10px;
        padding: 10px;
      }
      .kpi span {
        display: block;
        font-size: 12px;
        color: #94a3b8;
      }
      .kpi strong {
        font-size: 16px;
        color: #f8fafc;
      }
      .btn {
        display: inline-block;
        padding: 10px 14px;
        background: #38bdf8;
        color: #0f172a;
        text-decoration: none;
        border-radius: 10px;
        font-weight: bold;
        margin-top: 8px;
      }
      .btn.secondary {
        background: #fbbf24;
      }
      .tag {
        display: inline-block;
        background: #334155;
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 11px;
        color: #cbd5f5;
      }
      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }
      .muted {
        color: #94a3b8;
        font-size: 12px;
      }
      .category {
        margin-top: 12px;
      }
      .category h4 {
        margin: 8px 0;
        font-size: 14px;
        color: #fbbf24;
      }
      .product {
        background: #0f172a;
        border-radius: 8px;
        padding: 8px 10px;
        margin-bottom: 6px;
        font-size: 13px;
      }
      .product img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 6px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1><?= title ?></h1>
      <p>Showcase priv√© des fonctions CRM BERT</p>
    </header>

    <div class="container">
      <div class="card">
        <div class="row">
          <h3>KPI du jour</h3>
          <span class="tag"><?= dateLabel ?></span>
        </div>
        <div class="kpi-grid">
          <div class="kpi"><span>Objectif</span><strong><?= kpi.goal ?></strong></div>
          <div class="kpi"><span>Vendu</span><strong><?= kpi.sold ?></strong></div>
          <div class="kpi"><span>Manque</span><strong><?= kpi.missing ?></strong></div>
          <div class="kpi"><span>% objectif</span><strong><?= kpi.pct ?>%</strong></div>
          <div class="kpi"><span>Ventas caja</span><strong><?= kpi.ventasCaja ?></strong></div>
          <div class="kpi"><span>Canasta prom.</span><strong><?= kpi.canastaProm ?></strong></div>
        </div>
        <p class="muted">Pace hora: <?= kpi.pacePerHour ?> | Gratis: <?= kpi.gratis ?></p>
      </div>

      <div class="card">
        <h3>Estado mes</h3>
        <p><strong><?= month.label ?></strong></p>
        <p>Objetivo: <?= month.obj ?> | Caja acumulada: <?= month.ventasCaja ?></p>
        <? if (month.pctMes) { ?>
          <p>% mes: <?= month.pctMes ?></p>
        <? } ?>
        <? if (month.gratisMes) { ?>
          <p>Gratis mes: <?= month.gratisMes ?></p>
        <? } ?>
      </div>

      <div class="card">
        <h3>Acciones r√°pidas</h3>
        <p class="muted">Ouvre le formulaire de vente ou retourne au bot.</p>
        <a class="btn" href="<?= formUrl ?>" onclick="return openFormLink();">üìù Formulario de venta</a>
        <a class="btn secondary" href="<?= botUrl ?>" target="_blank">ü§ñ Abrir Bot</a>
      </div>

      <div class="card">
        <h3>Charts disponibles</h3>
        <ul class="muted">
          <li>üìä Ventas hora (comparativo)</li>
          <li>üìÖ Ventas caja mensual</li>
          <li>üìà Estado del mes</li>
        </ul>
      </div>

      <div class="card">
        <h3>Cat√°logo por categor√≠as</h3>
        <? for (var i = 0; i < catalog.length; i++) { var cat = catalog[i]; ?>
          <div class="category">
            <h4><?= cat.name ?></h4>
            <? for (var j = 0; j < cat.items.length; j++) { ?>
              <div class="product">
                <? if (cat.items[j].fotoUrl) { ?>
                  <img src="<?= cat.items[j].fotoUrl ?>" alt="<?= cat.items[j].name ?>" />
                <? } ?>
                <?= cat.items[j].name ?>
              </div>
            <? } ?>
          </div>
        <? } ?>
      </div>
    </div>
    <script>
      function openFormLink() {
        try {
          if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.openLink("<?= formUrl ?>");
            return false;
          }
        } catch (e) {}
        return true;
      }
    </script>
  </body>
</html>